@startuml
!include style.puml

box Logic LOGIC_COLOR_T1
participant "a:AddAnnotationCommand" as AddAnnotationCommand LOGIC_COLOR
end box

box Model MODEL_COLOR_T1
participant "b:Bookmark" as Bookmark MODEL_COLOR
participant "doc:OfflineDocument" as OfflineDocument MODEL_COLOR
participant "an:Annotation" as Annotation MODEL_COLOR
participant ":TrueParagraph" as TrueParagraph MODEL_COLOR
end box

[->  AddAnnotationCommand
activate AddAnnotationCommand

AddAnnotationCommand -> Bookmark : getRequiredDoc(index, cacheVersion)
activate Bookmark

Bookmark --> AddAnnotationCommand : doc
deactivate Bookmark

create Annotation
AddAnnotationCommand -> Annotation
activate Annotation

Annotation --> AddAnnotationCommand : an
deactivate Annotation

AddAnnotationCommand -> OfflineDocument : addAnnotation(pid, an)
activate OfflineDocument

OfflineDocument -> TrueParagraph : addAnnotation(an)
activate TrueParagraph

TrueParagraph --> OfflineDocument
deactivate TrueParagraph

OfflineDocument --> AddAnnotationCommand
deactivate OfflineDocument

create OfflineCommandResult
AddAnnotationCommand -> OfflineCommandResult
activate OfflineCommandResult

OfflineCommandResult --> AddAnnotationCommand
deactivate OfflineCommandResult

AddAnnotationCommand --> LogicManager : result
deactivate AddAnnotationCommand

[<--LogicManager
deactivate LogicManager

destroy AddAnnotationCommand
@enduml
